<dom-module id="grid-pagination-demos">
  <template>
    <style include="vaadin-component-demo-shared-styles">
      :host {
        display: block;
      }
    </style>

    <style>
      vaadin-grid {
        text-transform: none;
      }
    </style>


    <h3>Pagination</h3>
    <p>
      The <code>&lt;vaadin-grid&gt;</code> is an infinitely scrolling list by nature, but simple pagination can be implemented for example by changing the grid's <code>items</code> array on page change.
    </p>
    <vaadin-demo-snippet id='grid-pagination-demos-pagination'>
      <template preserve-content>
        <style>
          #pages {
            display: flex;
            flex-wrap: wrap;
            margin: 20px;
          }

          #pages > button {
            user-select: none;
            padding: 5px;
            margin: 0 5px;
            border-radius: 10%;
            border: 0;
            background: transparent;
            font: inherit;
            outline: none;
            cursor: pointer;
          }

          #pages > button:hover,
          #pages > button:focus {
            color: #ccc;
            background-color: #eee;
          }

          #pages > button[selected] {
            font-weight: bold;
            color: white;
            background-color: #ccc;
          }
        </style>

        <x-array-data-provider></x-array-data-provider>

        <vaadin-grid page-size="10" height-by-rows>
          <vaadin-grid-column name="First"></vaadin-grid-column>
          <vaadin-grid-column name="Last"></vaadin-grid-column>
          <vaadin-grid-column width="200px" name="Email"></vaadin-grid-column>
        </vaadin-grid>

        <div id="pages"></div>

        <script>
          window.addDemoReadyListener('#grid-pagination-demos-pagination', function(document) {
            const grid = document.querySelector('vaadin-grid');
            let pages;

            const columns = grid.querySelectorAll('vaadin-grid-column');

            columns.forEach(function(column, index) {
              column.headerRenderer = function(root) {
                root.textContent = column.getAttribute('name');
              };
            });

            columns[0].renderer = function(root, column, model) {
              root.textContent = model.item.name.first;
            };

            columns[1].renderer = function(root, column, model) {
              root.textContent = model.item.name.last;
            };

            columns[2].renderer = function(root, column, model) {
              root.textContent = model.item.name.first + '.' + model.item.name.last + '@example.com';
            };

            updateItemsFromPage(1);


            function updateItemsFromPage(page) {
              const dataProvider = document.querySelector('x-array-data-provider');
              const items = dataProvider.items;

              if (items === undefined || page === undefined) {
                return;
              }

              document.querySelectorAll('#pages button').forEach(function(btn) {
                if (parseInt(btn.textContent) === page) {
                  btn.setAttribute('selected', true);
                } else {
                  btn.removeAttribute('selected');
                }
              });

              if (!pages) {
                pages = Array.apply(null, {length: Math.ceil(items.length / grid.pageSize)}).map(function(item, index) {
                  return index + 1;
                });

                const pagesControl = document.querySelector('#pages');
                pagesControl.innerHTML = '';

                const prevBtn = window.document.createElement('button');
                prevBtn.innerHTML = '&lt;';
                prevBtn.addEventListener('click', function() {
                  const selectedPage = parseInt(pagesControl.querySelector('[selected]').textContent);
                  updateItemsFromPage(Math.max(0, selectedPage - 1));
                });
                pagesControl.appendChild(prevBtn);

                pages.forEach(function(pageNumber) {
                  const pageBtn = window.document.createElement('button');
                  pageBtn.innerHTML = pageNumber;
                  pageBtn.addEventListener('click', function(e) {
                    updateItemsFromPage(parseInt(e.target.textContent));
                  });
                  if (pageNumber === page) {
                    pageBtn.setAttribute('selected', true);
                  }
                  pagesControl.appendChild(pageBtn);
                });

                const nextBtn = window.document.createElement('button');
                nextBtn.innerHTML = '&gt;';
                nextBtn.addEventListener('click', function() {
                  const selectedPage = parseInt(pagesControl.querySelector('[selected]').textContent);
                  updateItemsFromPage(Math.min(pages.length - 1, selectedPage + 1));
                });
                pagesControl.appendChild(nextBtn);
              }

              var start = page * grid.pageSize;
              var end = (page + 1) * grid.pageSize;
              grid.items = items.slice(start, end);
            }
          });
        </script>
      </template>
    </vaadin-demo-snippet>

  </template>
  <script>
    class GridPaginationDemos extends DemoReadyEventEmitter(GridDemo(Polymer.Element)) {
      static get is() {
        return 'grid-pagination-demos';
      }
    }
    customElements.define(GridPaginationDemos.is, GridPaginationDemos);
  </script>
</dom-module>
