<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<script>
  window.Vaadin = window.Vaadin || {};
  window.Vaadin.Grid = window.Vaadin.Grid || {};

  /**
   * @polymerMixin
   */
  Vaadin.Grid.FilterMixin = superClass => class FilterMixin extends superClass {

    static get properties() {
      return {
        _filters: {
          type: Array,
          value: function() {
            return [];
          }
        }
      };
    }

    ready() {
      super.ready();
      this.addEventListener('filter-changed', this._filterChanged.bind(this));
    }

    _filterChanged(e) {
      const index = this._filters.indexOf(e.target);
      if (index === -1) {
        this._filters.push(e.target);
      }
      else if (!e.target.value || e.target.value === "") {
        this._filters.splice(index, 1);
      }

      e.stopPropagation();

      if (this.dataProvider) {
        this.clearCache();
      }
    }

    _mapFilters() {
      return this._filters.map(filter => {
        return {
          path: filter.path,
          value: filter.value
        };
      });
    }
  };
</script>
