<!doctype html>

<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <link rel="import" href="../../test-fixture/test-fixture.html">

  <link rel="import" href="helpers.html">
  <link rel="import" href="../vaadin-grid.html">
</head>

<body>

  <test-fixture id="auto-width">
    <template>
      <vaadin-grid style="width: 600px; height: 200px;">
        <vaadin-grid-column auto-width flex-grow="0" path="a"></vaadin-grid-column>
        <vaadin-grid-column auto-width flex-grow="0" path="b"></vaadin-grid-column>
        <vaadin-grid-column auto-width flex-grow="0" path="c"></vaadin-grid-column>
        <vaadin-grid-column auto-width flex-grow="0" path="d" header="foo bar baz"></vaadin-grid-column>
      </vaadin-grid>
    </template>
  </test-fixture>

  <script>
    describe('column auto-width', () => {
      let grid;
      let columns;

      beforeEach(() => {
        grid = fixture('auto-width');
        grid.items = [
          {a: 'fubar', b: 'foo', c: 'foo', d: 'a'},
          {a: 'foo', b: 'foo bar baz', c: 'foo', d: 'bar'},
          {a: 'foo', b: 'foo baz', c: 'foo bar', d: 'baz'},
        ];
        columns = grid.querySelectorAll('vaadin-grid-column');

        flushGrid(grid);
      });

      it('should have correct column widths', done => {
        // Allowed margin of measurement to keep the test from failing if there are small differences in rendered text
        // width on different platforms or if there are small changes to styles which affect horizontal margin/padding.
        const delta = 5;

        // recalculateColumnWidths() is run in requestAnimationFrame
        Polymer.Async.animationFrame.run(() => {
          expect(parseInt(columns[0].width)).to.be.closeTo(71, delta);
          expect(parseInt(columns[1].width)).to.be.closeTo(114, delta);
          expect(parseInt(columns[2].width)).to.be.closeTo(84, delta);
          expect(parseInt(columns[3].width)).to.be.closeTo(107, delta);

          done();
        });
      });

    });
  </script>

</body>

</html>
