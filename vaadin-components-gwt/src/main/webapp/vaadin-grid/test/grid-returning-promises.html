<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
  <script src="../../bower_components/web-component-tester/browser.js"></script>
  <script src="../../VaadinGrid/VaadinGrid.nocache.js"></script>

  <script src="common.js"></script>

  <link rel="import" href="../vaadin-grid.html">
</head>
<body>

<div id="gridwrapper"></div>

<script>
  describe.feature('returning promises', function() {
    function expectToBeAPromise(obj) {
      expect(obj).to.have.property('then');
    };

    describe('using then()', function() {

      beforeEach(function() {
        grid.grid.onReady = sinon.spy(function(fn) {
          fn(arguments);
        });
      });

      it('should wait for grid ready', function() {
        return grid.then(function() {
          expect(grid.grid.onReady.calledOnce).is.true;
        });
      });

      describe('with a callback', function() {
        it('should call callback always', function() {
          var callback = sinon.spy();

          grid.then(callback).then(function() {
            expect(callback.calledOnce).is.true;
          });
        })

        it('should return a value from callback', function() {
          return grid.then(function() {
            return 'foobar';
          }).then(function(n) {
            expect(n).to.equal('foobar');
          });
        });

        it('should catch the error from callback', function() {
          var err = new Error;

          return grid.then(function() {
            throw err;
          }).catch(function(e) {
            expect(e).to.eql(err);
          });
        });

        it('should wait ready multiple times if requested', function() {
          return grid.then(function() { return grid; })
              .then(function() {
                expect(grid.grid.onReady.calledTwice).is.true;
              });
        });
      });
    });

    it('should return a promise from scrollToRow', function() {
      expectToBeAPromise(grid.scrollToRow(0));
    });

    it('should return a promise from scrollToStart', function() {
      expectToBeAPromise(grid.scrollToStart());
    });

    it('should return a promise from scrollToEnd', function() {
      expectToBeAPromise(grid.scrollToEnd());
    });
  });

</script>
</body>
</html>
