<!--
@license
Copyright (c) 2016 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<!--

`vaadin-grid-filter` is a helper element for the `vaadin-grid` that provides out-of-the-box UI controls,
and handlers for filtering the grid data.

-->

<dom-module id="vaadin-grid-filter">
  <template>
    <style>
      :host {
        display: inline-flex;
      }

      #filter {
        width: 100%;
        box-sizing: border-box;
      }
    </style>

    <content select="*">
      <input id="filter" value="{{value::input}}">
    </content>

  </template>
  <script>
    Polymer({
      is: 'vaadin-grid-filter',

      properties: {

        /**
         * JS Path of the property in the item used for filtering the data.
         */
        path: String,

        /**
         * Current filter value.
         */
        value: {
          type: String,
          notify: true
        }
      },

      observers: ['_filterChanged(path, value, isAttached)'],

      _filterChanged: function(path, value, isAttached) {
        if (isAttached) {
          this.debounce('filter-changed', function() {
            this.fire('filter-changed');
          }, 200);
        }
      }
    });
  </script>
</dom-module>

<script>
  window.vaadin = window.vaadin || {};
  vaadin.elements = vaadin.elements || {};
  vaadin.elements.grid = vaadin.elements.grid || {};

  /**
   * @polymerBehavior vaadin.elements.grid.FilterBehavior
   */
  vaadin.elements.grid.FilterBehavior = {
    properties: {

      _filters: {
        value: function() {
          return [];
        }
      }

    },

    listeners: {
      'filter-changed': '_filterChanged'
    },

    _filterChanged: function(e) {
      if (this._filters.indexOf(e.target) === -1) {
        this._filters.push(e.target);
      }

      e.stopPropagation();

      if (this.dataSource) {
        this.clearCache();
      }
    },

    _mapFilters: function() {
      return this._filters.map(function(filter) {
        return {
          path: filter.path,
          value: filter.value
        };
      });
    },
  };
</script>
