<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="vaadin-grid-column.html">

<dom-module id="vaadin-grid-hierarchy-column">
  <template>
    <template class="header" id="defaultHeaderTemplate"></template>
    <template id="defaultBodyTemplate">
      <span index="[[index]]"
          hidden$="[[!item.hasChildren]]"
          expanded$="[[hierarchyExpanded]]"
          level$="[[hierarchyLevel]]"
          on-click="_onClick"
          style="
            cursor: pointer;
            padding-left: calc([[hierarchyLevel]] * 1em)
          ">
        <dom-if if="[[!hierarchyExpanded]]">
          <template>➕</template>
        </dom-if>
        <dom-if if="[[hierarchyExpanded]]">
          <template>➖</template>
        </dom-if>
      </span>
    </template>
  </template>
</dom-module>

<script>
  {
    /**
     * `<vaadin-grid-hierarchy-column>` is a helper element for the `<vaadin-grid>`
     * that provides default templates and functionality for the item hierarchy.
     *
     * #### Example:
     * ```html
     * <vaadin-grid>
     *   <vaadin-grid-hierarchy-column frozen></vaadin-grid-hierarchy-column>
     *
     *   <vaadin-grid-column><template>[[index]]<template></vaadin-grid-column>
     *   <!-- ... -->
     *  </vaadin-grid>
     * ```
     *
     * @memberof Vaadin
     * @mixes Vaadin.GridColumnElement
     */
    class GridHierarchyColumnElement extends Vaadin.GridColumnElement {
      static get is() {
        return 'vaadin-grid-hierarchy-column';
      }

      static get properties() {
        return {
          /**
            * Width of the cells for this column.
            */
          width: {
            type: String,
            value: '8em'
          },

          /**
            * Flex grow ratio for the cell widths. When set to 0, cell width is fixed.
            */
          flexGrow: {
            type: Number,
            value: 0
          },

          /**
          * @private
          */
          headerTemplate: Object,

          /**
          * @private
          */
          template: Object,

        };
      }

      _prepareHeaderTemplate() {
        const headerTemplate = this._prepareTemplatizer(this._findTemplate('template.header') || this.$.defaultHeaderTemplate);
        // needed to override the dataHost correctly in case internal template is used.
        headerTemplate.templatizer.dataHost = headerTemplate === this.$.defaultHeaderTemplate ? this : this.dataHost;

        return headerTemplate;
      }

      _prepareBodyTemplate() {
        const template = this._prepareTemplatizer(this._findTemplate('template:not(.header):not(.footer)') || this.$.defaultBodyTemplate);
        // needed to override the dataHost correctly in case internal template is used.
        template.templatizer.dataHost = template === this.$.defaultBodyTemplate ? this : this.dataHost;

        return template;
      }

      _onClick(e) {
        if (!this._grid) {
          return;
        }

        e.preventDefault();

        const index = e.target.index;
        if (this._grid.isIndexExpanded(index)) {
          this._grid.collapseIndex(index);
        } else {
          this._grid.expandIndex(index);
        }
      }
    }

    customElements.define(GridHierarchyColumnElement.is, GridHierarchyColumnElement);

    /**
     * @namespace Vaadin
     */
    window.Vaadin = window.Vaadin || {};
    Vaadin.GridHierarchyColumnElement = GridHierarchyColumnElement;
  }
</script>
